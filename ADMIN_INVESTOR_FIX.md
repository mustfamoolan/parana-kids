# ุงูุญู ุงูุฌุฐุฑู: ูุนุงููุฉ ุงููุฏูุฑ ูุซู ุจุงูู ุงููุณุชุซูุฑูู ุชูุงูุงู

## ๐ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ุชู ุงูุชุดุงููุง

ุจุนุฏ ุงูุจุญุซ ุงูุนูููุ ุงูุชุดููุง ุฃู ุงููุดููุฉ ุงูุญููููุฉ ูุงูุช ูู ูุนุงููุฉ **ุงููุฏูุฑ** ุจุทุฑููุฉ ูุฎุชููุฉ ุนู ุจุงูู ุงููุณุชุซูุฑูู.

### ูุง ูุงู ูุญุฏุซ ุณุงุจูุงู:

1. **ุงููุณุชุซูุฑูู ุงูุนุงุฏููู**:
   - โ ุฃุฑุจุงุญูู ุชูุณุฌู ูู `InvestorProfit` ูู `pending`
   - โ ูููุชูู ุงููุณุชุฑุฌุนุฉ ุชุฐูุจ ูุจุงุดุฑุฉ ูุฎุฒูุชูู ุงูุฎุงุตุฉ
   - โ ูุธูุฑ ููู ููุท ูุนุงููุงุช ุงูุงุณุชุซูุงุฑุงุช ุงููุนููุฉ

2. **ุงููุฏูุฑ (is_admin = true)**:
   - โ **ูุงู** ูุชู ุฅูุฏุงุน ุฃุฑุจุงุญู ููููุชู ูู `$investment->project->treasury`
   - โ ุฎุฒูุฉ ุงููุดุฑูุน (`treasury_id` ูู ุฌุฏูู `projects`) ูุงูุช **ููุณูุง** ุฎุฒูุฉ ุงููุณุชุซูุฑ ุงููุฏูุฑ
   - โ ูุฐุง ูุงู ูุณุจุจ ุธููุฑ **ุฌููุน** ูุนุงููุงุช ุงููุดุฑูุน (ุญุชู ุบูุฑ ุงูุงุณุชุซูุงุฑูุฉ) ูู ุฎุฒูุฉ ุงููุฏูุฑ

### ุงูููุฏ ุงููุฏูู ุงููุดูู:

ูู `app/Services/InvestorProfitCalculator.php`:

```php
// ูู distributeProductProfit() ู distributeWarehouseProfit()
if ($investment->project && $investment->project->treasury) {
    // ุญุณุงุจ ูุณุจุฉ ุงููุฏูุฑ
    $adminPercentage = ...;
    
    // ุฅูุฏุงุน ุฑุจุญ ุงููุฏูุฑ ูู ุฎุฒูุฉ ุงููุดุฑูุน โ
    $investment->project->treasury->deposit(
        $adminProfit,
        'order',
        $orderId,
        "ุฑุจุญ ุงููุฏูุฑ ูู ุงุณุชุซูุงุฑ..."
    );
    
    // ุฅูุฏุงุน ูููุฉ ุงููุฏูุฑ ูู ุฎุฒูุฉ ุงููุดุฑูุน โ
    $investment->project->treasury->deposit(
        $adminCostReturned,
        'order',
        $orderId,
        "ุฅุฑุฌุงุน ูููุฉ ุงููุฏูุฑ..."
    );
}
```

### ููุงุฐุง ูุฐุง ูุงู ูุณุจุจ ุงููุดููุฉุ

- ุฎุฒูุฉ ุงููุดุฑูุน (`$investment->project->treasury`) ูู **ููุณูุง** ุฎุฒูุฉ ุงููุณุชุซูุฑ ุงููุฏูุฑ (`$adminInvestor->treasury`)
- ุฃู `deposit` ูู ุฎุฒูุฉ ุงููุดุฑูุน = `deposit` ูู ุฎุฒูุฉ ุงููุฏูุฑ
- ูุฐุง ูุงู ูุณุจุจ ุธููุฑ ูุนุงููุงุช `order` ูุจุงุดุฑุฉ ูู ุฎุฒูุฉ ุงููุฏูุฑ
- ุญุชู ุงูุทูุจุงุช ูู ูุฎุงุฒู **ุจุฏูู ุงุณุชุซูุงุฑ** ูุงูุช ุชุธูุฑ ุฅุฐุง ูุงู ููุงู ุฃู ุฑุจุท ุจุงููุดุฑูุน

## โ ุงูุญู ุงูุฐู ุชู ุชุทุจููู

### ุญุฐู ุงูููุฏ ุงูุฎุงุต ุจุงููุฏูุฑ ุชูุงูุงู

ุชู **ุญุฐู** ุฌููุน ุงูุฃููุงุฏ ุงูุชู ูุงูุช ุชูุฏุน ุฑุจุญ/ูููุฉ ุงููุฏูุฑ ูู ุฎุฒูุฉ ุงููุดุฑูุน (90+ ุณุทุฑ).

ุงูุขู:
- โ **ุงููุฏูุฑ ูุนุงูู ูุซู ุจุงูู ุงููุณุชุซูุฑูู ุชูุงูุงู**
- โ ุฃุฑุจุงุญู ุชูุณุฌู ูู `InvestorProfit` ูู `pending`
- โ ูููุชู ุงููุณุชุฑุฌุนุฉ ุชุฐูุจ ูุฎุฒูุชู ุงูุฎุงุตุฉ (ุนุจุฑ ููุณ ุขููุฉ ุงููุณุชุซูุฑูู)
- โ ูุธูุฑ ูู ููุท ูุนุงููุงุช ุงูุงุณุชุซูุงุฑุงุช ุงููุนููุฉ (ุงูููุชุฑุฉ ุงูุชู ุชู ุชุทุจูููุง ุณุงุจูุงู)

## ๐ ุงูุชุนุฏููุงุช ุงูุชู ุชูุช

### ูู `app/Services/InvestorProfitCalculator.php`:

1. **ุญุฐู ุงูุณุทูุฑ 261-303** (ูู `distributeProductProfit`):
   - ุญุฐู ุฌููุน ุงูุฃููุงุฏ ุงูุชู ูุงูุช ุชูุฏุน ุฑุจุญ/ูููุฉ ุงููุฏูุฑ ูู `$investment->project->treasury`

2. **ุญุฐู ุงูุณุทูุฑ 491-533** (ูู `distributeWarehouseProfit`):
   - ุญุฐู ุฌููุน ุงูุฃููุงุฏ ุงูุชู ูุงูุช ุชูุฏุน ุฑุจุญ/ูููุฉ ุงููุฏูุฑ ูู `$investment->project->treasury`

3. **ุญุฐู ุงูุณุทูุฑ 199 ู 388**:
   - ุญุฐู `$investment->load('project.treasury');` ูุฃูู ูู ูุนุฏ ูุณุชุฎุฏูุงู

4. **ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ**:
   ```php
   // ููุงุญุธุฉ: ุงููุฏูุฑ ูุนุงูู ูุซู ุจุงูู ุงููุณุชุซูุฑูู ุชูุงูุงู
   // ุฃุฑุจุงุญู ููููุชู ุชูุณุฌู ูู InvestorProfit ูุฎุฒูุชู ุงูุฎุงุตุฉุ ูููุณ ูู ุฎุฒูุฉ ุงููุดุฑูุน
   ```

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ุงูุขู ุงููุฏูุฑ:

1. โ ููุถุงู ููุณุชุซูุฑ ุนุงุฏู ูู `investment_investors` ูุน ูุณุจุฉ ุฑุจุญ ููุณุจุฉ ูููุฉ
2. โ ุฃุฑุจุงุญู ุชูุณุฌู ูู `investor_profits` ูู `status='pending'`
3. โ ูููุชู ุงููุณุชุฑุฌุนุฉ ุชุฐูุจ ูุจุงุดุฑุฉ ูุฎุฒูุชู ุนุจุฑ `$investor->treasury->deposit()` ูุน `reference_type='cost_return'`
4. โ ูุนุงููุงุช ุฎุฒูุชู ุชูููุชุฑ ุจููุณ ุงูููุทู ุงููุทุจู ุนูู ุจุงูู ุงููุณุชุซูุฑูู
5. โ ูู ุชุธูุฑ ูู ุทูุจุงุช ูู ูุฎุงุฒู ุบูุฑ ุงุณุชุซูุงุฑูุฉ **ุฃุจุฏุงู**

### ุฎุฒูุฉ ุงููุดุฑูุน (`project->treasury`):

- โ๏ธ **ูู ุชุนุฏ ุชูุณุชุฎุฏู ููุฃุฑุจุงุญ/ุงููููุฉ ุนูู ุงูุฅุทูุงู**
- ูููู ุญุฐููุง ูุงุญูุงู ุฃู ุชุฑููุง ููุงุณุชุฎุฏุงูุงุช ุงูุฃุฎุฑู
- ุงูุขู ูู ุดูุก ูุชู ุนุจุฑ ุฎุฒูุงุช ุงููุณุชุซูุฑูู ููุท

## ๐ ุฎุทูุงุช ุงูุชุทุจูู ุนูู ุงูุณูุฑูุฑ

1. **ุณุญุจ ุงูุชุญุฏูุซุงุช**:
   ```bash
   git pull origin main
   ```

2. **ูุณุญ ุงูู Cache** (ููู ุฌุฏุงู!):
   ```bash
   php artisan cache:clear
   php artisan config:clear
   php artisan route:clear
   php artisan view:clear
   php artisan optimize:clear
   ```

3. **ุงูุชุญูู**:
   - ุงุฐูุจ ุฅูู `admin/investors/{id}` (ุตูุญุฉ ุงููุฏูุฑ)
   - ุชุญูู ูู "ูุนุงููุงุช ุฎุฒูุฉ ุงููุณุชุซูุฑ"
   - ูุฌุจ ุฃูุง ุชุธูุฑ **ุฃู** ุทูุจุงุช ูู ูุฎุงุฒู ุบูุฑ ุงุณุชุซูุงุฑูุฉ
   - ูุฌุจ ุฃู ุชุธูุฑ ููุท:
     - ูุนุงููุงุช `cost_return` ูู ุงูุทูุจุงุช ุงููุฑุชุจุทุฉ ุจุงูุงุณุชุซูุงุฑุงุช ุงููุนููุฉ
     - ูุนุงููุงุช `deposit`/`withdrawal` ุงููุฏููุฉ
     - ูุนุงููุงุช `profit_deposit` ุนูุฏ ุฅูุฏุงุน ุงูุฃุฑุจุงุญ ุงููุนููุฉ

## ๐ ููุชูุถูุญ ุจูุซุงู

### ูุจู ุงูุชุนุฏูู:
```
ุทูุจ #100 ูู ูุฎุฒู ุงุณุชุซูุงุฑ โ ุฑุจุญ ุงููุฏูุฑ ูุฐูุจ ูู project->treasury โ
ุทูุจ #101 ูู ูุฎุฒู ุนุงุฏู โ ูุง ูุฐูุจ ูู project->treasury โ
ููู project->treasury = ุงููุฏูุฑ investor->treasury
ููุงูุช ูุนุงููุงุช ุฃุฎุฑู ุชุธูุฑ ุจุณุจุจ ุฑุจุท ุงูุฎุฒูุฉ!
```

### ุจุนุฏ ุงูุชุนุฏูู:
```
ุทูุจ #100 ูู ูุฎุฒู ุงุณุชุซูุงุฑ:
  - ุฑุจุญ ุงููุฏูุฑ โ InvestorProfit (pending) โ
  - ูููุฉ ุงููุฏูุฑ โ investor->treasury->deposit(type='cost_return') โ
  - ููุชุฑุฉ ูู ุงูุนุฑุถ ูุถูุงู ุธููุฑ ุงููุนุงููุงุช ุงูุตุญูุญุฉ ููุท โ

ุทูุจ #101 ูู ูุฎุฒู ุนุงุฏู:
  - ูุง ููุฑ ุนุจุฑ InvestorProfitCalculator ุฃุตูุงู โ
  - ูู ูุธูุฑ ูู ุฎุฒูุฉ ุงููุฏูุฑ ุฃุจุฏุงู โ
```

## ๐ก ููุงุญุธุงุช ูููุฉ

1. **ูุง ุญุงุฌุฉ ูุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**: ุงูุชุนุฏูู ูู ุงูููุฏ ููุท
2. **ุงูุจูุงูุงุช ุงููุฏููุฉ**: ูุฏ ุชุญุชุงุฌ ูุชูุธูู ุงููุนุงููุงุช ุงููุฏููุฉ ุงูุฎุงุทุฆุฉ ูุฏููุงู ุฃู ุชุฑู ุงูุณูุฑูุจุช ุงูุณุงุจู (`fix_old_project_transactions.php`)
3. **ุงูุงุณุชุซูุงุฑุงุช ุงููุฏููุฉ**: ุงูููุฏ ูุฏุนู ุงูุจููุฉ ุงููุฏููุฉ (`Investment` ูุจุงุดุฑุฉ) ูุงูุฌุฏูุฏุฉ (`InvestmentInvestor`)
4. **ูุง ุชุฃุซูุฑ ุนูู ุงููุณุชุซูุฑูู ุงูุขุฎุฑูู**: ุงูุชุนุฏูู ูุฎุต ุงููุฏูุฑ ููุท

---

**ุงูุฎูุงุตุฉ**: ุงููุดููุฉ ูุงูุช ุฃู ุงููุฏูุฑ ูุงู ูู ูุนุงููุฉ ุฎุงุตุฉ ุชุณุจุจ ุงูุฎูุท ุจูู ุฎุฒูุฉ ุงููุดุฑูุน ูุฎุฒูุชู. ุงูุขู ุฃุตุจุญ ูุซู ุจุงูู ุงููุณุชุซูุฑูู ุชูุงูุงูุ ููู ุชุธูุฑ ุฃู ุทูุจุงุช ุบูุฑ ุงุณุชุซูุงุฑูุฉ ูู ุฎุฒูุชู. ๐

