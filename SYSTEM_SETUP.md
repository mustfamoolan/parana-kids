# نظام Paraná Kids - دليل الإعداد والاستخدام (المحدث)

## نظرة عامة
تم تطوير نظام مصادقة متعدد الأدوار لنظام Paraná Kids مع ثلاثة أنواع من المستخدمين:
- **المدير (Admin)**: يدخل برقم الهاتف وكلمة المرور
- **المجهز (Supplier)**: يدخل برقم الهاتف وكلمة المرور  
- **المندوب (Delegate)**: يدخل بالكود وكلمة المرور

## الميزات المنجزة

### 1. نظام المصادقة المتعدد الأدوار ✅
- تم تعديل جدول `users` لإضافة الحقول الجديدة:
  - `role`: نوع المستخدم (admin, supplier, delegate)
  - `code`: كود المندوب أو المجهز
  - `phone`: رقم الهاتف (مطلوب لجميع المستخدمين)

### 2. نظام المخازن والمنتجات ✅

#### قاعدة البيانات
- **جدول المخازن (warehouses)**: اسم المخزن، الموقع، المستخدم المنشئ
- **جدول صلاحيات المخازن (warehouse_user)**: ربط المستخدمين بالمخازن مع صلاحيات الإدارة
- **جدول المنتجات (products)**: اسم المنتج، الكود، سعر الشراء، سعر البيع، الوصف
- **جدول صور المنتجات (product_images)**: صور المنتج مع إمكانية تحديد الصورة الرئيسية
- **جدول قياسات المنتجات (product_sizes)**: القياسات المختلفة مع العدد المتوفر لكل قياس

#### النماذج (Models)
- **Warehouse Model**: مع العلاقات والدوال المساعدة للتحقق من الصلاحيات
- **Product Model**: مع العلاقات للصور والقياسات والمخزن
- **ProductImage Model**: لإدارة صور المنتجات
- **ProductSize Model**: لإدارة قياسات المنتجات
- **User Model**: محدث مع علاقات المخازن والمنتجات

#### المتحكمات (Controllers)
- **AdminWarehouseController**: إدارة المخازن (إنشاء، تعديل، حذف، تعيين المستخدمين)
- **AdminProductController**: إدارة المنتجات (إنشاء، تعديل، حذف، رفع الصور)
- **DelegateWarehouseController**: عرض المخازن المسموح للمندوب بها
- **DelegateProductController**: عرض المنتجات (عرض فقط)

#### الصلاحيات (Policies)
- **WarehousePolicy**: التحكم في صلاحيات الوصول للمخازن
- **ProductPolicy**: التحكم في صلاحيات إدارة المنتجات

### 3. واجهة المستخدم ✅
- **صفحات تسجيل الدخول**: منفصلة للمدير/المجهز والمندوب
- **Layouts مخصصة**: للأدمن والمندوب مع جميع المكونات
- **Sidebar ذكي**: يعرض القوائم حسب الدور
- **Header محدث**: يعرض معلومات المستخدم والدور

### 4. البيانات التجريبية ✅
تم إنشاء بيانات تجريبية شاملة:
- **3 مخازن**: الرياض، جدة، الدمام
- **صلاحيات مخصصة**: المجهز يدير مخزنين، المندوبين لهم صلاحيات مختلفة
- **15 منتج**: 5 منتجات في كل مخزن مع قياسات مختلفة
- **قياسات متنوعة**: S, M, L, XL للألبسة و 28-42 للبناطيل و 38-42 للأحذية

## كيفية الإعداد

### 1. تشغيل المايجريشن والبيانات التجريبية
```bash
php artisan migrate:fresh --seed
```

### 2. تشغيل الخادم
```bash
php artisan serve
```

## كيفية الاختبار

### تسجيل دخول المدير
1. اذهب إلى: `http://localhost:8000/admin/login`
2. أدخل رقم الهاتف: `0501234567`
3. أدخل كلمة المرور: `password`
4. ستتم إعادة التوجيه إلى لوحة تحكم المدير
5. يمكنك الوصول إلى جميع المخازن والمنتجات

### تسجيل دخول المجهز
1. اذهب إلى: `http://localhost:8000/admin/login`
2. أدخل رقم الهاتف: `0507654321`
3. أدخل كلمة المرور: `password`
4. ستتم إعادة التوجيه إلى لوحة تحكم المجهز
5. يمكنك إدارة المخازن المعينة لك فقط

### تسجيل دخول المندوب
1. اذهب إلى: `http://localhost:8000/delegate/login`
2. أدخل الكود: `DEL001` (أو `DEL002` أو `DEL003`)
3. أدخل كلمة المرور: `password`
4. ستتم إعادة التوجيه إلى لوحة تحكم المندوب
5. يمكنك عرض المخازن والمنتجات المسموح لك بها فقط

## الميزات الخاصة

### 1. صلاحيات المخازن
- **المدير**: يرى جميع المخازن ويمكنه إدارتها وتعيين المستخدمين
- **المجهز**: يرى فقط المخازن المعينة له مع صلاحية الإدارة
- **المندوب**: يرى فقط المخازن المعينة له (عرض فقط)

### 2. إدارة المنتجات
- **سعر الشراء**: يظهر فقط للمدير
- **القياسات**: كل منتج له قياسات مخصصة مع العدد المتوفر
- **الصور**: يمكن رفع حتى 5 صور لكل منتج
- **الكود**: فريد لكل منتج (كتابة يدوية)

### 3. قوائم مخصصة حسب الدور
- **المدير**: لوحة التحكم، إدارة المستخدمين، المخازن
- **المجهز**: لوحة التحكم، المخازن، التقارير
- **المندوب**: لوحة التحكم، المخازن، المهام

### 4. معلومات المستخدم في Header
- يعرض اسم المستخدم الحقيقي
- يعرض الدور باللغة العربية (مدير/مجهز/مندوب)
- يعرض البريد الإلكتروني أو رقم الهاتف
- زر تسجيل الخروج يوجه للمسار الصحيح حسب الدور

## المسارات المتاحة

### للمدير والمجهز
- `/admin/warehouses` - قائمة المخازن
- `/admin/warehouses/create` - إنشاء مخزن جديد
- `/admin/warehouses/{id}` - تفاصيل المخزن
- `/admin/warehouses/{id}/edit` - تعديل المخزن
- `/admin/warehouses/{id}/assign-users` - تعيين المستخدمين للمخزن
- `/admin/warehouses/{warehouse}/products` - منتجات المخزن
- `/admin/products/{id}` - تفاصيل المنتج
- `/admin/products/{id}/edit` - تعديل المنتج

### للمندوب
- `/delegate/warehouses` - قائمة المخازن المسموح بها
- `/delegate/warehouses/{warehouse}/products` - منتجات المخزن (عرض فقط)
- `/delegate/products/{id}` - تفاصيل المنتج (عرض فقط)

## الملفات المهمة

### Controllers
- `app/Http/Controllers/Admin/WarehouseController.php`
- `app/Http/Controllers/Admin/ProductController.php`
- `app/Http/Controllers/Delegate/WarehouseController.php`
- `app/Http/Controllers/Delegate/ProductController.php`

### Models
- `app/Models/Warehouse.php`
- `app/Models/Product.php`
- `app/Models/ProductImage.php`
- `app/Models/ProductSize.php`

### Policies
- `app/Policies/WarehousePolicy.php`
- `app/Policies/ProductPolicy.php`

### Database
- `database/migrations/2025_10_18_212739_create_warehouses_table.php`
- `database/migrations/2025_10_18_212740_create_warehouse_user_table.php`
- `database/migrations/2025_10_18_212742_create_products_table.php`
- `database/migrations/2025_10_18_212744_create_product_images_table.php`
- `database/migrations/2025_10_18_212745_create_product_sizes_table.php`
- `database/seeders/WarehouseSeeder.php`

## الخطوات التالية المقترحة

1. **إنشاء Views للمخازن والمنتجات** - صفحات العرض والإدارة
2. **إضافة نظام رفع الصور** - مع التحقق من نوع وحجم الملف
3. **تحسين واجهة المستخدم** - إضافة DataTables والبحث والفلترة
4. **إضافة نظام التقارير** - تقارير المخزون والمبيعات
5. **إضافة نظام المهام للمندوبين** - تتبع المهام والطلبات

## ملاحظات مهمة

1. **Storage**: تم إنشاء symbolic link للصور في `public/storage`
2. **الصلاحيات**: جميع الصفحات محمية بـ Policies وMiddleware
3. **البيانات**: جميع البيانات التجريبية باللغة العربية
4. **التصميم**: جميع الصفحات تستخدم تصميم القالب الموجود
5. **الأمان**: التحقق من الصلاحيات في كل مستوى

## الدعم الفني

إذا واجهت أي مشاكل أو تحتاج إلى إضافة ميزات جديدة، يمكنك:
1. مراجعة ملفات النظام المذكورة أعلاه
2. التحقق من logs Laravel في `storage/logs/`
3. التأكد من صحة إعدادات قاعدة البيانات في `.env`

---
**تم التطوير بواسطة**: نظام Paraná Kids
**تاريخ التحديث**: 2024
**المرحلة الحالية**: نظام المخازن والمنتجات مكتمل
